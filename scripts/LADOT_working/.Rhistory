library(sf)
getwd()
setwd("C:/Project/APP/APP/scripts/LADOT_working")
pkgs <- c("tidyverse", "readxl", "lubridate")
lapply(pkgs, library, character.only = TRUE)
rm(pkgs)
# obtain specific year-workbook and its sheet names
wkb_name <- paste(yr, "Neighborhood Council Trip Matrix.xlsx")
# obtain specific year-workbook and its sheet names
wkb_name <- paste("yr", "Neighborhood Council Trip Matrix.xlsx")
dir_name <- c("../../data/LADOT/CPRA #22-10589 Data")
paste(dir_name, wkb_name)
dir_name <- c("../../data/LADOT/CPRA #22-10589 Data/")
paste(dir_name, wkb_name)
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", "yr", "Neighborhood Council Trip Matrix.xlsx", sep = "")
path_name
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", "yr", " Neighborhood Council Trip Matrix.xlsx", sep = "")
path_name
# Cleaning ########
years <- c("2019","2020","2021","2022") # the four years of the different workbooks
my_output <- NULL
for (yr in years) {
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", yr, " Neighborhood Council Trip Matrix.xlsx", sep = "")
sheet_names <- excel_sheets(path_name)
# read, clean, and append all the sheets from the specific workbook
for (one_month in sheet_names) {
one_sheet <- read_excel(wkb_name, sheet = one_month) %>%
rename("Origin NC" = "Origin\\Destination") %>%
pivot_longer(cols = -c("Origin NC"), names_to = "Destination NC", values_to = "Trips") %>%
mutate(Month = mdy(paste(one_month,"1",yr)))
my_output <- bind_rows(output, one_sheet)
}
rm(one_sheet,yr,one_month,path_name,sheet_names)
}
# Cleaning ########
years <- c("2019","2020","2021","2022") # the four years of the different workbooks
my_output <- NULL
for (yr in years) {
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", yr, " Neighborhood Council Trip Matrix.xlsx", sep = "")
sheet_names <- excel_sheets(path_name)
# read, clean, and append all the sheets from the specific workbook
for (one_month in sheet_names) {
one_sheet <- read_excel(wkb_name, sheet = one_month) %>%
rename("Origin NC" = "Origin\\Destination") %>%
pivot_longer(cols = -c("Origin NC"), names_to = "Destination NC", values_to = "Trips") %>%
mutate(Month = mdy(paste(one_month,"1",yr)))
my_output <- bind_rows(output, one_sheet)
}
rm(one_sheet,yr,one_month,path_name,sheet_names)
}
for (yr in years) {
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", yr, " Neighborhood Council Trip Matrix.xlsx", sep = "")
sheet_names <- excel_sheets(path_name)
# read, clean, and append all the sheets from the specific workbook
for (one_month in sheet_names) {
one_sheet <- read_excel(path_name, sheet = one_month) %>%
rename("Origin NC" = "Origin\\Destination") %>%
pivot_longer(cols = -c("Origin NC"), names_to = "Destination NC", values_to = "Trips") %>%
mutate(Month = mdy(paste(one_month,"1",yr)))
my_output <- bind_rows(output, one_sheet)
}
rm(one_sheet,yr,one_month,path_name,sheet_names)
}
# Cleaning ########
years <- c("2019","2020","2021","2022") # the four years of the different workbooks
my_output <- NULL
for (yr in years) {
# obtain specific year-workbook and its sheet names
path_name <- paste("../../data/LADOT/CPRA #22-10589 Data/", yr, " Neighborhood Council Trip Matrix.xlsx", sep = "")
sheet_names <- excel_sheets(path_name)
# read, clean, and append all the sheets from the specific workbook
for (one_month in sheet_names) {
one_sheet <- read_excel(path_name, sheet = one_month) %>%
rename("Origin NC" = "Origin\\Destination") %>%
pivot_longer(cols = -c("Origin NC"), names_to = "Destination NC", values_to = "Trips") %>%
mutate(Month = mdy(paste(one_month,"1",yr)))
my_output <- bind_rows(my_output, one_sheet)
}
rm(one_sheet,yr,one_month,path_name,sheet_names)
}
View(my_output)
# Add Geos ########
library(sf)
nc_geos = read_sf("../../data/geos/Neighborhood Councils (Certified)/geo_export_71f6a568-febe-403c-898f-4ce9286a58a2.shp")
View(nc_geos)
library(jsonlite)
lanc_geos = fromJSON(txt = "https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/18/query?outFields=*&where=1%3D1&f=geojson")
View(lanc_geos)
lanc_df = lanc_geos$features$properties
View(lanc_df)
lanc_df$NAME %in% nc_geos$name
arrange(lanc_df, NAME)
lanc_df %>% select(NAME) %>% arrange(NAME) %>%
mutate(check = NAME %in% nc_geos %>% select(name) %>% arrange(name))
lanc_df %>% select(NAME) %>% arrange(NAME) %>%
mutate(check = NAME %in% (nc_geos %>% select(name) %>% arrange(name)))
nchar(nc_geos$name)
nchar(lanc_df$NAME)
nc_geos %>% select(name) %>% arrange(name)
lanc_df %>% select(NAME) %>% arrange(NAME)
lanc_df$NC_ID %in% nc_geos$nc_id
lanc_df$NC_ID
nc_geos$nc_id
sort(nc_geos$nc_id)
sort(lanc_df$NC_ID)
sort(lanc_df$NC_ID) %in% sort(nc_geos$nc_id)
library(geojsonio)
spdf <- geojson_read("https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/18/query?outFields=*&where=1%3D1&f=geojson",  what = "sp")
spdf <- geojson_read("https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/18/query?outFields=*&where=1%3D1&f=geojson")
spdf <- read_sf("https://maps.lacity.org/lahub/rest/services/Boundaries/MapServer/18/query?outFields=*&where=1%3D1&f=geojson")
View(spdf)
getwd()
st_write(spdf, "is_this_.geojson")
